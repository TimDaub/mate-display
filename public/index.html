<html>
    <head>
        <script>
            function toQueryString(obj) {
                if (!obj) {
                    return "";
                }
                return Object.keys(obj).reduce(function(init, curr) {
                    if (init === "?") {
                        return init + curr + "=" + obj[curr];
                    } else {
                        return init + "&" + curr + "=" + obj[curr];
                    }
                }, "?");
            }

            function get(path, obj) {
                var params = toQueryString(obj)

                var Http = new XMLHttpRequest();
                var url= path + params;
                Http.open("GET", url);
                Http.send();
                Http.onreadystatechange=(e)=>{
                    console.log(Http.responseText)
                }
            }

            function parseInputs(program) {
                var inputs = document.querySelectorAll(
                    '*[data-program="'+program+'"],[data-program="all"]'
                );
                // convert NodeList to array
                inputs = Array.prototype.slice.call(inputs);

                params = inputs.reduce(function(init, curr) {
                    var key = curr.getAttribute("data-key");
                    var value = curr.value;
                    init[key] = value;
                    return init;
                }, {program: program})

                return params
            }

            function trigger(program) {
                var params = parseInputs(program);
                get("rpc", params);
                event.preventDefault();
            }

            function cancel() {
                get("cancel")
            }
            function updateFiles() {
                get("updatefiles")
            }
            function dropdown() {
                document.getElementById("devbox").classList.toggle("show");
            }
        </script>
        <style>
        .slider{
          width: 25%;
          height: 5px;
        background: #d3d3d3;
        opacity: 0.7;
        }
        .slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 15px;
          height: 15px;
          border-radius: 75%;
          background: #4CAF50;
          cursor: pointer;
        }
        .slider::-moz-range-thumb {
          width: 15px;
          height: 15px;
          border-radius: 75%;
          background: #4768cc;
          cursor: pointer;
        }
        .dropbtn {
          background-color: inherit;
          color: grey;
          font-size: inherit;
          border: none;
        }
        .dropdown {
          position: relative;
          display: inline-block;
        }
        .dropdown-content{
          color: grey;
          font-size: inherit;
          display: none;
          position: absolute;
          padding: 10px;
          min-width: 400px;
          overflow: auto;
          z-index: 1;
        }
        .show {display: block;}
        </style>
    </head>
    <body>
      <h1>Mate Display</h1>
      <p>
      Brightness:
      <input
        type="range"
        class="slider"
        data-program="all"
        data-key="brightness"
        min="1"
        max="100"
        value="100">
      </p>
      <p>
        <button onclick="cancel()">Clear</button>
      </p>
      <p>
        <b>Sin wave ~ </b>
        <button onclick="trigger('sin')">Start!</button>
      </br>
      <p>
        <b>Colorpattern ~ </b>
        <button onclick="trigger('colorpulse')">Start!</button>
      </br>
        Distance:
        <input
          type="number"
          placeholder="from 1 to 50"
          data-program='colorpulse'
          data-key="distance"
          min="1"
          max="50">
        </br>
        Speed:
        <select data-key="steps" data-program="colorpulse">
          <option value="1">ambient</option>
          <option value="5">chill</option>
          <option value="15">avg</option>
          <option value="51">fast</option>
          <option value="85">wild</option>
        </select>
      </br>
      <p>
        <b>Scroll text ~ </b>
        <p onclick="trigger('scroll')">Start!</p>
        </br>
        Text:
        <input data-key="text" data-program='scroll' type="text">
        </br>
      </p>
      <p>
        <b>Fireworks ~ </b>
        <button onclick="trigger('random')">Start!</button>
        </br>
        Probability:
        <select data-key="probability" data-program='random'>
          <option value="2">very many</option>
          <option value="10">many</option>
          <option value="50">a few</option>
        </select>
      </p>
      <p>
        <b>DVD Screensaver ~ </b>
        <button onclick="trigger('dvd')">Start!</button>
      </p>
      </br>
      <div class="dropdown">
          <button onclick="dropdown()" class="dropbtn">dev tools</button>
          <div id="devbox" class="dropdown-content">
            ~ update from git
            <button onclick="updateFiles()">Start!</button>
          </div>
      </div>
    </body>
</html>
