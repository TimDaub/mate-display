<html>
    <head>
        <script>
            function toQueryString(obj) {
                if (!obj) {
                    return "";
                }
                return Object.keys(obj).reduce(function(init, curr) {
                    if (init === "?") {
                        return init + curr + "=" + obj[curr];
                    } else {
                        return init + "&" + curr + "=" + obj[curr];
                    }
                }, "?");
            }

            function get(path, obj) {
                var params = toQueryString(obj)

                var Http = new XMLHttpRequest();
                var url= path + params;
                Http.open("GET", url);
                Http.send();
                Http.onreadystatechange=(e)=>{
                    console.log(Http.responseText)
                }
            }

            function parseInputs(program) {
                var inputs = document.querySelectorAll(
                    '*[data-program="'+program+'"]'
                );
                // convert NodeList to array
                inputs = Array.prototype.slice.call(inputs);

                params = inputs.reduce(function(init, curr) {
                    var key = curr.getAttribute("data-key");
                    var value = curr.value;
                    init[key] = value;
                    return init;
                }, {program: program})

                return params
            }

            function trigger(program) {
                var params = parseInputs(program);
                get("rpc", params);
            }

            function cancel() {
                get("cancel")
            }
        </script>
    </head>
    <body>
        <h1>Mate Display</h1>
        <input
            type="number"
            placeholder="sleep time  e.g. 20000"
            data-program="sin"
            data-key="rate"/>
        <button onclick="trigger('sin')">Sin Wave</button>
        <button onclick="cancel()">Clear</button>
        <img src="qr.png" alt="site"/>
        <p>
          <button onclick="trigger('colorpulse')">Colorpattern</button>
          <input data-key="distance" data-program='colorpulse' type="number" min="1" max="50">
          <select data-key="steps" data-program="colorpulse">
            <option value="1">srsly slow</option>
            <option value="3">slow</option>
            <option value="5">chill</option>
            <option value="15">avg</option>
            <option value="51">fast</option>
            <option value="85">wild</option>
          </select>
        </p>
        <p>
          <button onclick="trigger('scroll')">Scroll text</button>
          <input data-key="text" data-program='scroll' type="text">
          <input placeholder="10000" data-key="speed" data-program='scroll' type="number">
        </p>
        <p>
          <button onclick="trigger('random')">Random colors</button>
          <input placeholder="5" data-key="probability" data-program='random' type="number">
        </p>
        </br>


    </body>
</html>
